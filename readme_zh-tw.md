# å±•å ´åœ°åœ–å°èˆªå°ˆæ¡ˆ

æœ¬å°ˆæ¡ˆæ—¨åœ¨å»ºç«‹ä¸€å€‹å±•å ´åœ°åœ–çš„æ•¸ä½åŒ–è§£æ±ºæ–¹æ¡ˆï¼Œæœ€çµ‚ç›®æ¨™æ˜¯èƒ½æä¾›å¾ç‰¹å®šèµ·é»ï¼ˆå¦‚ Dell boothï¼‰åˆ°å…¶ä»–å±•ä½æˆ–å€åŸŸçš„æ–‡å­—å°èˆªã€‚

## å°ˆæ¡ˆç›®æ¨™èˆ‡å‰æ

-   **ç›®æ¨™**: å»ºç«‹ä¸€å€‹æ•¸ä½åŒ–çš„å±•å ´åœ°åœ–ï¼Œæä¾›å±•ä½é–“çš„æ–‡å­—å°èˆªã€‚
-   **å‰æ**:
    -   åŸå§‹åœ°åœ– (https://siggraph25.mapyourshow.com/8_0/exhview/index.cfm) ç‚ºç¶²è·¯ Canvas Render æ ¼å¼ï¼Œç„¡æ³•ç›´æ¥æå–å±•ä½è³‡è¨Šã€‚
    -   è©²åœ°åœ– Canvas åœ¨ Hover æœƒ Hightlight boothï¼Œåˆ©ç”¨é€™ç‰¹æ€§åµæ¸¬
    -   åœ°åœ–ä¸Šçš„å±•ä½ä½ˆå±€æ˜¯ç¶²æ ¼å°é½Šçš„ã€‚
    -   åˆ©ç”¨é›»è…¦è¦–è¦º (CV) èˆ‡å…‰å­¸å­—å…ƒè¾¨è­˜ (OCR) æŠ€è¡“ä¾†è§£æåœ°åœ–ã€‚

## âœ¨ ä»»å‹™é€²åº¦ (TODOs)

-   [x] **ç¶²æ ¼å»ºç«‹èˆ‡ç®¡ç†**: å°‡åœ°åœ–è½‰æ›ç‚ºçµæ§‹åŒ–çš„ç¶²æ ¼è³‡æ–™ (`data/grid.json`)ã€‚
-   [x] **æ‰‹å‹•æ¨™è¨»å·¥å…·**: æä¾› GUI å·¥å…· (`core/annotate.py`) é€²è¡Œäººå·¥æ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤ç¶²æ ¼ã€‚
-   [x] **OCR è³‡è¨Šæ“·å–**: è‡ªå‹•è­˜åˆ¥å±•ä½åç¨±èˆ‡ç·¨è™Ÿï¼Œä¸¦å¡«å…¥ç¶²æ ¼è³‡æ–™ä¸­ã€‚
-   [x] **è·¯å¾‘è¨ˆç®—**: å·²å¯¦ä½œ A* æ¼”ç®—æ³• (`core/pathfinder.py`) èˆ‡æ‰¹æ¬¡é é‹ç®—è…³æœ¬ (`scripts/precompute_routes.py`)ã€‚
-   [x] **è·¯å¾‘å¯è¦–åŒ–**: æ–°å¢è¦–è¦ºåŒ–æ¨¡çµ„ (`core/viz.py`) èˆ‡è¼”åŠ©è…³æœ¬ (`scripts/visualize_routes.py`, `scripts/batch_visualize.py`)ã€‚
-   [ ] **æ–‡å­—å°èˆªç”Ÿæˆ**: å°‡è·¯å¾‘è½‰æ›ç‚ºè‡ªç„¶èªè¨€çš„å°èˆªæŒ‡ä»¤ã€‚

> è©³ç´°çš„æŠ€è¡“è¦åŠƒèˆ‡æ­·å²é€²åº¦è«‹åƒé–±ï¼š[`task.md`](./task.md)

---

## ğŸ“¸ å‰ç½®æ­¥é©Ÿ (è³‡æ–™æº–å‚™)

åœ¨é–‹å§‹å»ºç«‹ç¶²æ ¼å‰ï¼Œæˆ‘å€‘éœ€è¦å¾ç·šä¸Šåœ°åœ–ç²å–åŸå§‹çš„å±•ä½æ•¸æ“šã€‚

1.  **éŒ„å½±ç·šä¸Šåœ°åœ–**: åœ¨ç¶²é ä¸ŠéŒ„è£½åœ°åœ–å½±ç‰‡ï¼Œä¸¦é€ä¸€ hover éæ‰€æœ‰å±•ä½ï¼Œä½¿å…¶ highlightã€‚
    > **æ³¨æ„**: åœ°åœ–å¯èƒ½å¤ªå¤§ï¼Œéœ€è¦åˆ†å¤šæ¬¡éŒ„å½±ä¾†æ¶µè“‹æ‰€æœ‰å€åŸŸã€‚

2.  **è™•ç†å–®å€‹å½±ç‰‡**: ä½¿ç”¨ `notebooks/single_detect.ipynb` è™•ç†æ¯å€‹éŒ„è£½çš„å½±ç‰‡ï¼Œå°‡å½±ç‰‡ä¸­æ‰€æœ‰ highlight çš„å±•ä½å€åŸŸè½‰æ›ç‚ºåœ¨åœ°åœ–å¤§åœ–ä¸Šçš„ç¶²æ ¼æ¡† (grid box)ï¼Œä¸¦å°‡çµæœå„²å­˜ç‚º `bboxed_{i}.json`ã€‚
    ```
    notebooks/single_detect.ipynb
    ```

3.  **åˆä½µèˆ‡è¨ˆç®—ç¶²æ ¼å–®ä½**: ä½¿ç”¨ `notebooks/01_build_grid.ipynb` åˆä½µä¾†è‡ªå¤šå€‹å½±ç‰‡çš„ç¶²æ ¼æ¡†æ•¸æ“šï¼Œä¸¦è¨ˆç®—å‡ºçµ±ä¸€çš„ç¶²æ ¼å–®ä½ã€‚é€™å°‡ç”Ÿæˆ `data/grid.json` ä½œç‚ºä¸»è¦çš„ç¶²æ ¼è³‡æ–™ä¾†æºã€‚
    ```
    notebooks/01_build_grid.ipynb
    ```

---

## ğŸš€ ä¸»è¦å·¥ä½œæµç¨‹

æœ¬å°ˆæ¡ˆçš„å·¥ä½œæµç¨‹è¨­è¨ˆç‚ºå¹¾å€‹ç¨ç«‹ä½†ç’°ç’°ç›¸æ‰£çš„æ­¥é©Ÿï¼Œè®“æ‚¨å¯ä»¥å¾ªåºæ¼¸é€²åœ°å¾ä¸€å¼µåœ°åœ–åœ–ç‰‡ï¼Œæœ€çµ‚ç”¢å‡ºå®Œæ•´çš„å°èˆªè³‡è¨Šã€‚

### æ­¥é©Ÿ 1: å»ºç«‹èˆ‡ä¿®æ­£ç¶²æ ¼
åœ¨å®Œæˆå‰ç½®æ­¥é©Ÿç”Ÿæˆåˆå§‹ç¶²æ ¼æ•¸æ“šå¾Œï¼Œä½¿ç”¨æ‰‹å‹•å·¥å…·é€²è¡Œç²¾ç´°èª¿æ•´èˆ‡è£œå……ã€‚

1.  **æ‰‹å‹•æ¨™è¨»èˆ‡ä¿®æ­£**: ä½¿ç”¨ GUI å·¥å…·é€²è¡Œç²¾ç´°èª¿æ•´ã€‚é€™æ˜¯ç¢ºä¿è³‡æ–™å“è³ªæœ€é—œéµçš„ä¸€æ­¥ã€‚
    ```bash
    python core/annotate.py
    ```
    -   **æ“ä½œ**: æ»‘é¼ å·¦éµæ‹–æ›³æ–°å¢æ ¼å­ï¼Œå³éµé»æ“Šé€²è¡Œä¿®æ”¹æˆ–åˆªé™¤ã€‚
    -   **ç›®æ¨™**: ç¢ºä¿æ‰€æœ‰å±•ä½ã€èµ°é“ã€å…¬å…±å€åŸŸéƒ½è¢«æ­£ç¢ºæ¨™è¨˜ã€‚

2.  **å»ºç«‹é¡å‹å…ƒæ•¸æ“š**: æƒæ `grid.json` ä¸­å·²æœ‰çš„ `type` æ¬„ä½ï¼Œè‡ªå‹•å»ºç«‹æˆ–æ›´æ–° `data/grid_types.json`ã€‚
    ```bash
    python scripts/build_type_metadata.py
    ```
    > **é‡è¦**: `data/grid_types.json` å®šç¾©äº†æ¯ç¨®æ ¼å­çš„å±¬æ€§ï¼ˆå¦‚æ˜¯å¦å¯è¡Œèµ°ã€é¡¯ç¤ºé¡è‰²ç­‰ï¼‰ï¼Œæ˜¯è·¯å¾‘è¨ˆç®—çš„åŸºç¤ï¼Œè«‹å‹™å¿…åœ¨é–‹å§‹ OCR æˆ–è·¯å¾‘è¨ˆç®—å‰åŸ·è¡Œæ­¤æ­¥é©Ÿã€‚

### æ­¥é©Ÿ 2: åŸ·è¡Œ OCR è­˜åˆ¥
ç¶²æ ¼å»ºç«‹å®Œæˆå¾Œï¼ŒåŸ·è¡Œ OCR ä¾†è‡ªå‹•å¡«å¯«å±•ä½åç¨±èˆ‡ç·¨è™Ÿã€‚

1.  **åŸ·è¡Œæ‰¹æ¬¡ OCR**: æ­¤è…³æœ¬æœƒè™•ç†æ‰€æœ‰éœ€è¦è­˜åˆ¥çš„æ ¼å­ã€‚
    ```bash
    python scripts/ocr_batch.py
    ```
    > **æç¤º**: é¦–æ¬¡åŸ·è¡Œæˆ–æ ¼å­æ•¸é‡å¤šæ™‚ï¼Œæ­¤éç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“ã€‚è…³æœ¬æ”¯æ´ `--limit` åƒæ•¸é€²è¡Œæ¸¬è©¦ã€‚

2.  **äººå·¥å¯©æ ¸èˆ‡ä¿®æ­£**:
    -   é–‹å•Ÿ `data/ocr_results.json` æª”æ¡ˆã€‚
    -   äººå·¥æª¢æŸ¥ä¸¦ä¿®æ­£æ¨¡å‹è­˜åˆ¥éŒ¯èª¤çš„ `name` æˆ– `booth_id`ã€‚

3.  **å¥—ç”¨ä¿®æ­£çµæœ**: å°‡ä¿®æ­£å¾Œçš„çµæœå¯«å›ä¸»è¦çš„ `grid.json` æª”æ¡ˆã€‚
    ```bash
    python scripts/apply_ocr_results.py --backup
    ```

> é—œæ–¼ OCR æ¨¡çµ„æ›´è©³ç´°çš„èªªæ˜ï¼Œè«‹åƒé–±ï¼š[`docs/OCR_USAGE.md`](./docs/OCR_USAGE.md)

### æ­¥é©Ÿ 3: è·¯å¾‘è¨ˆç®—èˆ‡é é‹ç®— (NEW)

```python
# äº’å‹•å¼è¨ˆç®—å–®ä¸€è·¯å¾‘
from core.pathfinder import Pathfinder
pf = Pathfinder()
route = pf.find_route(start_idx=1, target_idx=53)
print(route)
```
```bash
# æ‰¹æ¬¡é é‹ç®—ï¼šå¾æŒ‡å®šå±•ä½åˆ°æ‰€æœ‰å±•ä½
python scripts/precompute_routes.py --start 1
```

### æ­¥é©Ÿ 4: è·¯å¾‘å¯è¦–åŒ– (NEW)

1. **å¿«é€Ÿé è¦½ï¼ˆç”Ÿæˆå°‘é‡è·¯å¾‘ï¼‰**
   ```bash
   python scripts/visualize_routes.py routes/1_to_all.json --limit 3
   ```
2. **å®Œæ•´ç”Ÿæˆï¼ˆä¾é¡å‹åˆ†çµ„ï¼Œæ¨è–¦ï¼‰**
   ```bash
   python scripts/batch_visualize.py routes/1_to_all.json --show-stats
   ```
   - è¼¸å‡ºè‡³ `visualizations_by_type/{type}/viz_{src}_to_{dst}.png`
   - å…¨åŸŸæ ¼å­ä»¥ 30 % é€æ˜åº¦é¡¯ç¤ºï¼Œèµ· / çµ‚é»æ ¼å­ 60 % ä¸é€æ˜åº¦é«˜äº®

> å…¶ä»–åƒæ•¸ï¼ˆ`--crop-padding`, `--route-color`, `--line-width`, `--uniform-color` ç­‰ï¼‰å¯é€é `-h` æŸ¥çœ‹èªªæ˜ã€‚

---

## ğŸ”§ ç’°å¢ƒå®‰è£

1.  **è¤‡è£½å°ˆæ¡ˆ**:
    ```bash
    git clone <repository-url>
    cd <repository-name>
    ```

2.  **å®‰è£ Python ä¾è³´**:
    å»ºè­°ä½¿ç”¨è™›æ“¬ç’°å¢ƒ (å¦‚ `venv` æˆ– `conda`)ã€‚
    ```bash
    # å»ºç«‹è™›æ“¬ç’°å¢ƒ
    python -m venv venv
    # å•Ÿç”¨è™›æ“¬ç’°å¢ƒ
    source venv/bin/activate  # on Windows: venv\Scripts\activate
    
    # å®‰è£æ ¸å¿ƒä¾è³´
    pip install opencv-python numpy Pillow
    ```

3.  **å®‰è£èˆ‡è¨­å®š Ollama (OCR åŠŸèƒ½æ‰€éœ€)**:
    ```bash
    # 1. å®‰è£ Ollama (è‹¥å°šæœªå®‰è£)
    curl -fsSL https://ollama.com/install.sh | sh

    # 2. å•Ÿå‹• Ollama æœå‹™ (é€šå¸¸æœƒè‡ªå‹•å•Ÿå‹•)
    ollama serve

    # 3. ä¸‹è¼‰ OCR æ‰€éœ€çš„è¦–è¦ºæ¨¡å‹
    ollama pull qwen2.5vl:7b
    
    # 4. å®‰è£ Ollama Python å®¢æˆ¶ç«¯
    pip install ollama
    ```

## ğŸ“š è©³ç´°æ–‡ä»¶

-   [**æŠ€è¡“ä»»å‹™èˆ‡è¦åŠƒ** (`task.md`)](./task.md): æ·±å…¥äº†è§£æ¯å€‹æ¨¡çµ„çš„è¨­è¨ˆç´°ç¯€ã€è³‡æ–™æµèˆ‡æ­·å²é€²åº¦ã€‚
-   [**OCR æ¨¡çµ„ä½¿ç”¨æ‰‹å†Š** (`docs/OCR_USAGE.md`)](./docs/OCR_USAGE.md): åŒ…å« OCR æ¨¡çµ„çš„è©³ç´°åƒæ•¸è¨­å®šã€æ•…éšœæ’é™¤èˆ‡é€²éšç”¨æ³•ã€‚